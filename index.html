<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Outil T√¢ches + Modules</title>
<style>
body { font-family: Arial,sans-serif; margin:0; padding:0; background:#f7f7f7; }
header { background:#0044aa; color:white; padding:10px 20px; display:flex; align-items:center; justify-content:space-between; }
header h1 { margin:0; font-size:1.5em; }
main { display:flex; gap:20px; padding:20px; flex-wrap:wrap; }
.section { background:white; padding:15px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1); flex:1 1 45%; min-width:300px; }
#taskInput { width:70%; padding:6px; font-size:1em; }
button { padding:5px 10px; margin:2px; cursor:pointer; }
.task-item, .module-item { border-bottom:1px solid #ddd; padding:5px 0; }
.comment-section { flex-direction:column; margin-top:5px; background:#f1f1f1; padding:5px; border-radius:5px; }
.comment-list { margin:0; padding-left:15px; }
.comment-input { display:flex; gap:5px; margin-top:5px; }
#promptsContainer button { background:#0044aa; color:white; border:none; border-radius:4px; }
.module-header { font-weight:bold; margin-top:10px; margin-bottom:5px; }
textarea.note { width:100%; resize:none; margin-top:3px; padding:3px; }
</style>
</head>
<body>

<header>
  <h1>Outil T√¢ches + Modules</h1>
  <select id="llmSelect">
    <option value="https://chat.openai.com/">GPT</option>
    <option value="https://www.perplexity.ai/">Perplexity</option>
    <option value="https://www.anthropic.com/claude">Claude</option>
    <option value="https://www.mistral.ai/">Mistral</option>
  </select>
</header>

<main>
  <!-- STACK 1 : T√¢ches -->
  <div class="section" id="stack1">
    <h2>Input t√¢ches</h2>
    <div>
      <input type="text" id="taskInput" placeholder="Nouvelle t√¢che‚Ä¶">
      <button id="addBtn">Ajouter</button>
    </div>
    <div class="buttons-row" style="margin-top:10px;">
      <button id="clearBtn">üßπ Tout nettoyer</button>
      <button id="archiveBtn">üìÇ Archiver JSON</button>
    </div>
    <ul id="tasksContainer"></ul>

    <h3>Prompts</h3>
    <div id="promptsContainer"></div>

    <h3>Coller JSON depuis LLM</h3>
    <textarea id="jsonPaste" rows="5" style="width:100%;"></textarea>
    <button id="sendToModulesBtn">Envoyer ce batch ‚Üí Modules</button>
  </div>

  <!-- STACK 2 : Modules -->
  <div class="section" id="stack2">
    <h2>Modules Actionables</h2>
    <div id="modulesContainer"></div>
  </div>
</main>

<script>
// --- STACK 1 ---
const taskInput = document.getElementById("taskInput");
const addBtn = document.getElementById("addBtn");
const tasksContainer = document.getElementById("tasksContainer");
const clearBtn = document.getElementById("clearBtn");
const archiveBtn = document.getElementById("archiveBtn");
const promptsContainer = document.getElementById("promptsContainer");
const llmSelect = document.getElementById("llmSelect");
const jsonPaste = document.getElementById("jsonPaste");
const sendToModulesBtn = document.getElementById("sendToModulesBtn");

let tasks = JSON.parse(localStorage.getItem("tasks")) || [];

function formatDate(iso){ return new Date(iso).toLocaleString(); }

function renderTasks(){
  tasksContainer.innerHTML="";
  tasks.forEach((task,i)=>{
    const li=document.createElement("li"); li.className="task-item";
    const taskText=document.createElement("div");
    taskText.textContent=task.text + " ("+formatDate(task.date)+")"; taskText.style.cursor="pointer";

    const commentBlock=document.createElement("div"); commentBlock.className="comment-section"; commentBlock.style.display="none";
    const commentList=document.createElement("ul"); commentList.className="comment-list";
    if(task.comments?.length) task.comments.forEach(c=>{
      const cLi=document.createElement("li"); cLi.textContent=`[${formatDate(c.date)}] ${c.text}`; commentList.appendChild(cLi);
    });
    commentBlock.appendChild(commentList);

    const commentInputDiv=document.createElement("div"); commentInputDiv.className="comment-input";
    const commentInput=document.createElement("input"); commentInput.placeholder="Ajouter un commentaire‚Ä¶";
    const commentBtn=document.createElement("button"); commentBtn.textContent="+";
    commentBtn.addEventListener("click",(e)=>{ e.stopPropagation(); const val=commentInput.value.trim(); if(val!==""){ if(!task.comments) task.comments=[]; task.comments.push({text:val,date:new Date().toISOString()}); localStorage.setItem("tasks",JSON.stringify(tasks)); commentInput.value=""; renderTasks(); } });
    commentInputDiv.appendChild(commentInput); commentInputDiv.appendChild(commentBtn); commentBlock.appendChild(commentInputDiv);

    taskText.addEventListener("click",()=>{ commentBlock.style.display = commentBlock.style.display==="none"?"flex":"none"; });
    li.appendChild(taskText); li.appendChild(commentBlock); tasksContainer.appendChild(li);
  });
}

// Ajouter t√¢che
addBtn.addEventListener("click",()=>{
  const text=taskInput.value.trim(); if(text!==""){ tasks.push({text,date:new Date().toISOString(),comments:[]}); localStorage.setItem("tasks",JSON.stringify(tasks)); taskInput.value=""; renderTasks(); }
});

// Nettoyer / Archiver
clearBtn.addEventListener("click",()=>{ if(confirm("Es-tu s√ªr ?")){ tasks=[]; localStorage.removeItem("tasks"); renderTasks(); } });
archiveBtn.addEventListener("click",()=>{
  if(tasks.length===0){ alert("Aucune t√¢che !"); return; }
  const blob=new Blob([JSON.stringify(tasks,null,2)],{type:"application/json"});
  const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url;
  a.download=`taches_${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.json`;
  document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
});

// Prompts
const promptList=[
  {id:"planifier",label:"Plan",text:"Transforme ces t√¢ches en plan structur√© √©tape par √©tape :"},
  {id:"prioriser",label:"Priorit√©",text:"Classe ces t√¢ches par ordre de priorit√© et urgence :"},
  {id:"categoriser",label:"Cat√©gories",text:"Range ces t√¢ches dans des cat√©gories logiques :"}
];
promptsContainer.innerHTML="";
promptList.forEach(p=>{
  const btn=document.createElement("button"); btn.textContent=p.label;
  btn.addEventListener("click",()=>{
    const combined=p.text + "\n\n" + tasks.map(t=>{
      let str="- "+t.text; if(t.comments?.length) str+="\n  Commentaires :\n"+t.comments.map(c=>`    - [${formatDate(c.date)}] ${c.text}`).join("\n"); return str;
    }).join("\n");
    navigator.clipboard.writeText(combined).then(()=>{ window.open(llmSelect.value,"_blank"); alert("‚úÖ Prompt + t√¢ches copi√©s et LLM ouvert !"); });
  });
  promptsContainer.appendChild(btn);
});

// --- STACK 2 ---
const modulesContainer = document.getElementById("modulesContainer");

function createModulesFromJSON(json){
  modulesContainer.innerHTML="";
  // Jalons
  if(json.jalons?.length){
    const div=document.createElement("div"); div.className="module-header"; div.textContent="Jalons & Sous-actions"; modulesContainer.appendChild(div);
    json.jalons.forEach(j=>{
      const li=document.createElement("div"); li.className="module-item";
      const cb=document.createElement("input"); cb.type="checkbox"; li.appendChild(cb);
      li.appendChild(document.createTextNode(" "+j.titre));
      modulesContainer.appendChild(li);
    });
  }
  // Messages
  if(json.messages?.length){
    const div=document.createElement("div"); div.className="module-header"; div.textContent="Mails / Messages"; modulesContainer.appendChild(div);
    json.messages.forEach(m=>{
      const li=document.createElement("div"); li.className="module-item";
      const cb=document.createElement("input"); cb.type="checkbox"; li.appendChild(cb);
      li.appendChild(document.createTextNode(" "+m.sujet+" ‚Üí "+m.destinataire));
      const note=document.createElement("textarea"); note.className="note"; note.placeholder="Ajouter note‚Ä¶"; li.appendChild(note);
      modulesContainer.appendChild(li);
    });
  }
  // Livrables
  if(json.livrables?.length){
    const div=document.createElement("div"); div.className="module-header"; div.textContent="Livrables"; modulesContainer.appendChild(div);
    json.livrables.forEach(l=>{
      const li=document.createElement("div"); li.className="module-item";
      const cb=document.createElement("input"); cb.type="checkbox"; li.appendChild(cb);
      li.appendChild(document.createTextNode(" "+l.titre+" ("+l.type+")"));
      const note=document.createElement("textarea"); note.className="note"; note.placeholder="Ajouter note‚Ä¶"; li.appendChild(note);
      modulesContainer.appendChild(li);
    });
  }
}

// Recevoir JSON depuis Stack1 ou LLM
sendToModulesBtn.addEventListener("click",()=>{
  try{
    const data=JSON.parse(jsonPaste.value.trim());
    createModulesFromJSON(data);
    // t√©l√©charger JSON
    const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
    const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url;
    a.download=`modules_${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.json`;
    document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
    alert("‚úÖ Modules g√©n√©r√©s et JSON t√©l√©charg√© !");
  }catch(err){ console.error(err); alert("‚ùå JSON invalide !"); }
});

</script>

</body>
</html>

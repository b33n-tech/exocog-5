<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Outil TÃ¢ches + Prompts</title>
<style>
body { font-family: Arial, sans-serif; margin: 0; padding: 0; background:#f7f7f7; }
header { background:#0044aa; color:white; padding:10px 20px; display:flex; align-items:center; justify-content:space-between; }
header h1 { margin:0; font-size:1.5em; }
main { display:flex; padding:20px; gap:20px; }
.section { background:white; padding:15px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1); flex:1; }
#taskInput { width:80%; padding:6px; font-size:1em; }
button { padding:5px 10px; margin:2px; cursor:pointer; }
.task-item { border-bottom:1px solid #ddd; padding:5px 0; }
.comment-section { flex-direction:column; margin-top:5px; background:#f1f1f1; padding:5px; border-radius:5px; }
.comment-list { margin:0; padding-left:15px; }
.comment-input { display:flex; gap:5px; margin-top:5px; }
#promptsContainer button { background:#0044aa; color:white; border:none; border-radius:4px; }
#tasksContainer { max-height:400px; overflow-y:auto; }
</style>
</head>
<body>

<header>
  <h1>Outil TÃ¢ches + Prompts</h1>
  <select id="llmSelect">
    <option value="https://chat.openai.com/">GPT</option>
    <option value="https://www.perplexity.ai/">Perplexity</option>
    <option value="https://www.anthropic.com/claude">Claude</option>
    <option value="https://www.mistral.ai/">Mistral</option>
  </select>
</header>

<main>
  <div class="section" style="flex:0.5;">
    <h2>Input tÃ¢ches</h2>
    <div>
      <input type="text" id="taskInput" placeholder="Nouvelle tÃ¢cheâ€¦">
      <button id="addBtn">Ajouter</button>
    </div>
    <div class="buttons-row" style="margin-top:10px;">
      <button id="clearBtn">ðŸ§¹ Tout nettoyer</button>
      <button id="archiveBtn">ðŸ“‚ Archiver JSON</button>
    </div>
    <ul id="tasksContainer"></ul>
  </div>

  <div class="section">
    <h2>Prompts</h2>
    <div id="promptsContainer"></div>
  </div>
</main>

<script>
// --- JS complet ---
const taskInput = document.getElementById("taskInput");
const addBtn = document.getElementById("addBtn");
const tasksContainer = document.getElementById("tasksContainer");
const clearBtn = document.getElementById("clearBtn");
const archiveBtn = document.getElementById("archiveBtn");
const llmSelect = document.getElementById("llmSelect");
const promptsContainer = document.getElementById("promptsContainer");

let tasks = JSON.parse(localStorage.getItem("tasks")) || [];

function formatDate(iso){ const d = new Date(iso); return d.toLocaleString(); }

function renderTasks(){
  tasksContainer.innerHTML="";
  tasks.forEach((task,i)=>{
    const li=document.createElement("li");
    li.className="task-item";

    const taskText=document.createElement("div");
    taskText.textContent = task.text + " ("+formatDate(task.date)+")";
    taskText.style.cursor="pointer";

    const commentBlock=document.createElement("div");
    commentBlock.className="comment-section";
    commentBlock.style.display="none";

    const commentList=document.createElement("ul");
    commentList.className="comment-list";
    if(task.comments?.length){
      task.comments.forEach(c=>{
        const cLi=document.createElement("li");
        cLi.textContent=`[${formatDate(c.date)}] ${c.text}`;
        commentList.appendChild(cLi);
      });
    }
    commentBlock.appendChild(commentList);

    const commentInputDiv=document.createElement("div");
    commentInputDiv.className="comment-input";
    const commentInput=document.createElement("input");
    commentInput.placeholder="Ajouter un commentaireâ€¦";
    const commentBtn=document.createElement("button");
    commentBtn.textContent="+";
    commentBtn.addEventListener("click", (e)=>{
      e.stopPropagation();
      const val=commentInput.value.trim();
      if(val!==""){
        if(!task.comments) task.comments=[];
        task.comments.push({text:val,date:new Date().toISOString()});
        localStorage.setItem("tasks",JSON.stringify(tasks));
        commentInput.value="";
        renderTasks();
      }
    });

    commentInputDiv.appendChild(commentInput);
    commentInputDiv.appendChild(commentBtn);
    commentBlock.appendChild(commentInputDiv);

    taskText.addEventListener("click", ()=>{
      commentBlock.style.display = commentBlock.style.display==="none"?"flex":"none";
    });

    li.appendChild(taskText);
    li.appendChild(commentBlock);
    tasksContainer.appendChild(li);
  });
}

// --- Ajouter tÃ¢che ---
addBtn.addEventListener("click", ()=>{
  const text=taskInput.value.trim();
  if(text!==""){
    tasks.push({text,date:new Date().toISOString(),comments:[]});
    localStorage.setItem("tasks",JSON.stringify(tasks));
    taskInput.value="";
    renderTasks();
  }
});

// --- Nettoyer / Archiver ---
clearBtn.addEventListener("click", ()=>{
  if(confirm("Es-tu sÃ»r ? Cette action est irrÃ©versible !")){
    tasks=[]; localStorage.removeItem("tasks"); renderTasks();
  }
});

archiveBtn.addEventListener("click", ()=>{
  if(tasks.length===0){ alert("Aucune tÃ¢che !"); return; }
  const blob = new Blob([JSON.stringify(tasks,null,2)],{type:"application/json"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a"); a.href=url;
  a.download=`taches_${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.json`;
  document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
});

// --- Section prompts ---
const promptList=[
  {id:"planifier",label:"Plan",text:"Transforme ces tÃ¢ches en plan structurÃ© Ã©tape par Ã©tape :"},
  {id:"prioriser",label:"PrioritÃ©",text:"Classe ces tÃ¢ches par ordre de prioritÃ© et urgence :"},
  {id:"categoriser",label:"CatÃ©gories",text:"Range ces tÃ¢ches dans des catÃ©gories logiques :"}
];

promptsContainer.innerHTML="";
promptList.forEach(p=>{
  const btn=document.createElement("button");
  btn.textContent=p.label;
  btn.addEventListener("click", ()=>{
    let combined=p.text + "\n\n" + tasks.map(t=>{
      let str="- "+t.text;
      if(t.comments?.length){
        str+="\n  Commentaires :\n"+t.comments.map(c=>`    - [${formatDate(c.date)}] ${c.text}`).join("\n");
      }
      return str;
    }).join("\n");
    navigator.clipboard.writeText(combined).then(()=>{
      window.open(llmSelect.value,"_blank");
      alert("âœ… Prompt + tÃ¢ches copiÃ©s, LLM ouvert !");
    });
  });
  promptsContainer.appendChild(btn);
});

renderTasks();
</script>

</body>
</html>
